<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字生成器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        .highlighted {
            background-color: #ffeb3b;
        }

        .count-item {
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            label, input, button {
                font-size: 16px;
            }

            button {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>

</head>
<body>
<div class="container">
    <h2>八字生成器</h2>
    <div class="form-group">
        <label for="name">姓名:</label>
        <input type="text" id="name">
    </div>
    <div class="form-group">
        <label for="birthdate">公历生日:</label>
        <input type="datetime-local" id="birthdate" min="1900-01-01T00:00" max="2100-12-31T23:59">
    </div>
    <button onclick="generateBazi()">生成八字</button>
    <div class="result" id="result"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
<script>
    const tianGanWuXing = {
        '甲': '木', '乙': '木', '丙': '火', '丁': '火', '戊': '土',
        '己': '土', '庚': '金', '辛': '金', '壬': '水', '癸': '水'
    };
    const diZhiWuXing = {
        '子': '水', '丑': '土', '寅': '木', '卯': '木', '辰': '土',
        '巳': '火', '午': '火', '未': '土', '申': '金', '酉': '金',
        '戌': '土', '亥': '水'
    };
    const mingJuMapping = {
        '木水': '印重局', '木火': '伤官局', '木土': '财旺局', '木金': '煞重局', '木木': '命旺局',
        '火木': '印重局', '火土': '伤官局', '火金': '财旺局', '火水': '煞重局', '火火': '命旺局',
        '土火': '印重局', '土金': '伤官局', '土水': '财旺局', '土木': '煞重局', '土土': '命旺局',
        '金土': '印重局', '金水': '伤官局', '金木': '财旺局', '金火': '煞重局', '金金': '命旺局',
        '水金': '印重局', '水木': '伤官局', '水火': '财旺局', '水土': '煞重局', '水水': '命旺局'
    };


    function generateBazi() {
        const name = document.getElementById('name').value;
        const d = document.getElementById('birthdate').value
        if (d === null || d === '') {
            return
        }
        const birthdate = new Date(d);
        const year = birthdate.getFullYear();
        const month = birthdate.getMonth();
        const day = birthdate.getDate();
        const hour = birthdate.getHours();
        // 假设通过某种方法获取到天干地支，实际需要调用专业的库
        const bazi = getTianGanDiZhi(birthdate);

        // const bazi = {
        //     year: {tg: '辛', dz: '亥'},
        //     month: {tg: '甲', dz: '午'},
        //     day: {tg: '壬', dz: '寅'},
        //     hour: {tg: '丙', dz: '午'}
        // };

        const yearTG = bazi.year.tg;
        const monthTG = bazi.month.tg;
        const dayTG = bazi.day.tg;
        const hourTG = bazi.hour.tg;

        const yearDZ = bazi.year.dz;
        const monthDZ = bazi.month.dz;
        const dayDZ = bazi.day.dz;
        const hourDZ = bazi.hour.dz;

        const dayTG_WuXing = tianGanWuXing[dayTG];
        const monthDZ_WuXing = diZhiWuXing[monthDZ];
        const ming = dayTG + dayTG_WuXing
        const ju = mingJuMapping[dayTG_WuXing + diZhiWuXing[monthDZ]];

        const counts = {
            '印重': 0,
            '伤官': 0,
            '财旺': 0,
            '煞重': 0,
            '比肩': 0
        };

        const elements = [tianGanWuXing[yearTG], tianGanWuXing[monthTG], tianGanWuXing[hourTG], diZhiWuXing[yearDZ], diZhiWuXing[monthDZ], diZhiWuXing[dayDZ], diZhiWuXing[hourDZ]];
        elements.forEach(element => {
            if (element === dayTG_WuXing) counts['比肩']++;
            if (dayTG_WuXing === '木' && element === '水') counts['印重']++;
            if (dayTG_WuXing === '木' && element === '火') counts['伤官']++;
            if (dayTG_WuXing === '木' && element === '土') counts['财旺']++;
            if (dayTG_WuXing === '木' && element === '金') counts['煞重']++;
            if (dayTG_WuXing === '火' && element === '木') counts['印重']++;
            if (dayTG_WuXing === '火' && element === '土') counts['伤官']++;
            if (dayTG_WuXing === '火' && element === '金') counts['财旺']++;
            if (dayTG_WuXing === '火' && element === '水') counts['煞重']++;
            if (dayTG_WuXing === '土' && element === '火') counts['印重']++;
            if (dayTG_WuXing === '土' && element === '金') counts['伤官']++;
            if (dayTG_WuXing === '土' && element === '水') counts['财旺']++;
            if (dayTG_WuXing === '土' && element === '木') counts['煞重']++;
            if (dayTG_WuXing === '金' && element === '土') counts['印重']++;
            if (dayTG_WuXing === '金' && element === '水') counts['伤官']++;
            if (dayTG_WuXing === '金' && element === '木') counts['财旺']++;
            if (dayTG_WuXing === '金' && element === '火') counts['煞重']++;
            if (dayTG_WuXing === '水' && element === '金') counts['印重']++;
            if (dayTG_WuXing === '水' && element === '木') counts['伤官']++;
            if (dayTG_WuXing === '水' && element === '火') counts['财旺']++;
            if (dayTG_WuXing === '水' && element === '土') counts['煞重']++;
        });
        console.log("counts: " + JSON.stringify(counts))

        let resultHtml = `<h3>结果:</h3>
                              <h3>${name}</h3>
                              <p>① ${ming}命   ② ${ju}(${monthDZ_WuXing})</p>
                              <p>公历：${birthdate.getFullYear()}年 ${birthdate.getMonth() + 1}月${birthdate.getDate()}日 ${birthdate.getHours()}点</p>
                              <p>农历：${bazi.year.nl}年 ${bazi.month.nl}月${bazi.day.nl} ${bazi.hour.nl}时</p>
                              <table>
                                <tr>
                                  <th>生辰八字</th>
                                  <th>年柱</th>
                                  <th>月柱</th>
                                  <th>日柱</th>
                                  <th>时柱</th>
                                </tr>
                                <tr>
                                  <td>天干</td>
                                  <td class="tg-cell" data-element="${yearTG}">${yearTG} (${tianGanWuXing[yearTG]})</td>
                                  <td class="tg-cell" data-element="${monthTG}">${monthTG} (${tianGanWuXing[monthTG]})</td>
                                  <td class="tg-cell" data-element="${dayTG}">${dayTG} (${tianGanWuXing[dayTG]})</td>
                                  <td class="tg-cell" data-element="${hourTG}">${hourTG} (${tianGanWuXing[hourTG]})</td>
                                </tr>
                                <tr>
                                  <td>地支</td>
                                  <td class="dz-cell" data-element="${yearDZ}">${yearDZ} (${diZhiWuXing[yearDZ]})</td>
                                  <td class="dz-cell" data-element="${monthDZ}">${monthDZ} (${diZhiWuXing[monthDZ]})</td>
                                  <td class="dz-cell" data-element="${dayDZ}">${dayDZ} (${diZhiWuXing[dayDZ]})</td>
                                  <td class="dz-cell" data-element="${hourDZ}">${hourDZ} (${diZhiWuXing[hourDZ]})</td>
                                </tr>
                              </table>

                             <table class="counts-table">
                            <tr>
                                <th>病与药</th>
                                <th>关系</th>
                                <th>五行</th>
                                <th>计数</th>
                            </tr>
                            <tr class="count-item" data-type="印重">
                                <td>${getBingOrYao('印重', monthDZ_WuXing, dayTG_WuXing)}</td>
                                <td>印重</td>
                                <td>${getRevertShengWuXing(dayTG_WuXing)}</td>
                                <td>${counts['印重']}</td>
                            </tr>
                            <tr class="count-item" data-type="伤官">
         <td>${getBingOrYao('伤官', monthDZ_WuXing, dayTG_WuXing)}</td>
                                <td>伤官</td>
                                <td>${getShengWuXing(dayTG_WuXing)}</td>
                                <td>${counts['伤官']}</td>
                            </tr>
                            <tr class="count-item" data-type="财旺">
         <td>${getBingOrYao('财旺', monthDZ_WuXing, dayTG_WuXing)}</td>
                                         <td>财旺</td>
                                <td>${getKeWuXing(dayTG_WuXing)}</td>
                                <td>${counts['财旺']}</td>
                            </tr>
                            <tr class="count-item" data-type="煞重">
         <td>${getBingOrYao('煞重', monthDZ_WuXing, dayTG_WuXing)}</td>
              <td>煞重</td>
                                <td>${getRevertKeWuXing(dayTG_WuXing)}</td>
                                <td>${counts['煞重']}</td>
                            </tr>
                            <tr class="count-item" data-type="比肩">
         <td>${getBingOrYao('比肩', monthDZ_WuXing, dayTG_WuXing)}</td>
                                         <td>比肩</td>
                                <td>${dayTG_WuXing}</td>
                                <td>${counts['比肩']}</td>
                            </tr>
                        </table>`;

        document.getElementById('result').innerHTML = '';
        document.getElementById('result').innerHTML = resultHtml;

        document.querySelectorAll('.count-item').forEach(item => {
            item.addEventListener('mouseover', function () {
                const type = this.getAttribute('data-type');
                const targetWuXing = getWuXingForType(type, dayTG_WuXing);
                console.log("局: " + type + "命：" + dayTG_WuXing + "八字：" + targetWuXing)

                document.querySelectorAll(`.tg-cell, .dz-cell`).forEach(cell => {
                    const element = cell.getAttribute('data-element');
                    const cellWuXing = tianGanWuXing[element] || diZhiWuXing[element];
                    console.log("cellWuXing" + cellWuXing)
                    console.log("targetWuXing" + targetWuXing)

                    if (type === '印重' && cellWuXing === (targetWuXing)) {
                        cell.classList.add('highlighted');
                    } else if (type === '伤官' && cellWuXing === (targetWuXing)) {
                        cell.classList.add('highlighted');
                    } else if (type === '财旺' && cellWuXing === (targetWuXing)) {
                        cell.classList.add('highlighted');
                    } else if (type === '煞重' && cellWuXing === (targetWuXing)) {
                        cell.classList.add('highlighted');
                    } else if (type === '比肩' && cellWuXing === targetWuXing) {
                        cell.classList.add('highlighted');
                    } else {
                        cell.classList.remove('highlighted');
                    }
                });
            });

            item.addEventListener('mouseout', function () {
                document.querySelectorAll('.tg-cell, .dz-cell').forEach(cell => {
                    cell.classList.remove('highlighted');
                });
            });
        });
    }

    function getBingOrYao(dataType, monthDZ_WuXing, dayTG_WuXing) {
        const hao = getKeWuXing(monthDZ_WuXing)
        const ke = getRevertKeWuXing(monthDZ_WuXing)
        const xie = getShengWuXing(monthDZ_WuXing)

        switch (dataType) {

            case '印重':
                const yinWuXing = getRevertShengWuXing(dayTG_WuXing)
                if (yinWuXing === monthDZ_WuXing) {
                    return '病根'
                } else if (yinWuXing === hao) {
                    return '耗(臣药)'
                } else if (yinWuXing === xie) {
                    return '泄(君药)'
                } else if (yinWuXing === ke) {
                    return '克'
                } else {
                    return '生病'
                }
            case '伤官':
                const shangGuanWuxing = getShengWuXing(dayTG_WuXing)
                if (shangGuanWuxing === monthDZ_WuXing) {
                    return '病根'
                } else if (shangGuanWuxing === hao) {
                    return '耗(臣药)'
                } else if (shangGuanWuxing === xie) {
                    return '泄(君药)'
                } else if (shangGuanWuxing === ke) {
                    return '克'
                } else {
                    return '生病'
                }
            case '财旺':
                const caiWangWuXing = getKeWuXing(dayTG_WuXing)
                if (caiWangWuXing === monthDZ_WuXing) {
                    return '病根'
                } else if (caiWangWuXing === hao) {
                    return '耗(臣药)'
                } else if (caiWangWuXing === xie) {
                    return '泄(君药)'
                } else if (caiWangWuXing === ke) {
                    return '克'
                } else {
                    return '生病'
                }
            case '煞重':
                const shangWuXing = getRevertKeWuXing(dayTG_WuXing)
                if (shangWuXing === monthDZ_WuXing) {
                    return '病根'
                } else if (shangWuXing === hao) {
                    return '耗(臣药)'
                } else if (shangWuXing === xie) {
                    return '泄(君药)'
                } else if (shangWuXing === ke) {
                    return '克'
                } else {
                    return '生病'
                }
            case '比肩':
                const biJianWuxing = dayTG_WuXing
                if (biJianWuxing === monthDZ_WuXing) {
                    return '病根'
                } else if (biJianWuxing === hao) {
                    return '耗(臣药)'
                } else if (biJianWuxing === xie) {
                    return '泄(君药)'
                } else if (biJianWuxing === ke) {
                    return '克'
                } else {
                    return '生病'
                }
            default:
                return null;
        }
    }

    function getWuXingForType(type, dayWuXing) {
        switch (type) {
            case '印重':
                return getRevertShengWuXing(dayWuXing);
            case '伤官':
                return getShengWuXing(dayWuXing);
            case '财旺':
                return getKeWuXing(dayWuXing);
            case '煞重':
                return getRevertKeWuXing(dayWuXing);
            case '比肩':
                return dayWuXing;
            default:
                return null;
        }
    }

    function getShengWuXing(wuXing) {
        const wuXingOrder = ['木', '火', '土', '金', '水'];
        const index = wuXingOrder.indexOf(wuXing);
        const target = wuXingOrder[(index + 1) % 5]
        // console.log(wuXing + "生" + target)
        return target;
    }

    function getRevertShengWuXing(wuXing) {
        const wuXingOrder = ['木', '火', '土', '金', '水'];
        const index = wuXingOrder.indexOf(wuXing);
        const target = wuXingOrder[(index + 4) % 5]
        console.log(wuXing + "生" + target)
        return target;
    }

    function getKeWuXing(wuXing) {
        const wuXingOrder = ['木', '火', '土', '金', '水'];
        const index = wuXingOrder.indexOf(wuXing);
        const target = wuXingOrder[(index + 2) % 5]
        console.log(wuXing + "克" + target)
        return target;
    }

    function getRevertKeWuXing(wuXing) {
        const wuXingOrder = ['木', '火', '土', '金', '水'];
        const index = wuXingOrder.indexOf(wuXing);
        const target = wuXingOrder[(index + 3) % 5]
        console.log(wuXing + "克" + target)
        return target;
    }

    // 计算天干地支
    function getTianGanDiZhi(birthdate) {
        var d = Lunar.fromDate(birthdate);
        let result = {
            year: {
                gl: d.getYear(),
                nl: d.getYearGan() + d.getYearZhi() + d.getYearShengXiao(),
                tg: d.getYearGan(),
                dz: d.getYearZhi()
            },
            month: {
                gl: d.getMonth(),
                nl: d.getMonthInChinese(),
                tg: d.getMonthGan(),
                dz: d.getMonthZhi()
            },
            day: {
                gl: d.getDay(),
                nl: d.getDayInChinese(),
                tg: d.getDayGan(),
                dz: d.getDayZhi()
            },
            hour: {
                gl: d.getTime(),
                nl: d.getTimeZhi(),
                tg: d.getTimeGan(),
                dz: d.getTimeZhi()
            }
        }
        return result
    }
</script>
</body>
</html>
